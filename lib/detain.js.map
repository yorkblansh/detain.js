{"version":3,"file":"detain.js","sources":["../src/detain.ts"],"sourcesContent":["export async function detain<\n\tInitialValue extends unknown,\n\tResultValue extends unknown\n>(props: {\n\t/**\n\t * Array of data\n\t */\n\tarray: InitialValue[]\n\n\t/**\n\t * Delay in milliseconds\n\t */\n\tdelayMs: number\n\n\t/**\n\t * Each value have to be returned\n\t *\n\t * in `Promise` or not:\n\t * ```ts\n\t * Promise<EachReturnType> | EachReturnType\n\t * ```\n\t */\n\teach: (\n\t\titem: InitialValue,\n\t\tindex: number\n\t) => Promise<ResultValue> | ResultValue\n\n\t/**\n\t * On each resolved value\n\t */\n\tonEach?: (item: ResultValue) => void\n\n\t/**\n\t * *coming soon*\n\t */\n\tonReject?: (reject: unknown) => void\n}) {\n\tconst { delayMs, each, array, onEach, onReject } = props\n\n\tlet results: ResultValue[] = []\n\n\tconst delay = (timeoutDelay: number, data?: string) =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tif (onReject) onReject(reject)\n\t\t\tsetTimeout(resolve.bind(null, data), timeoutDelay)\n\t\t})\n\n\tlet index = 0\n\n\tconst next = async (): Promise<unknown> => {\n\t\tif (index < array.length) {\n\t\t\tconst item = array[index]\n\t\t\tconst maybePromise = each(item, index) as Promise<ResultValue>\n\n\t\t\tindex++\n\n\t\t\tlet value: ResultValue\n\n\t\t\tif (maybePromise.then !== undefined) {\n\t\t\t\tvalue = (await maybePromise) as ResultValue\n\t\t\t} else {\n\t\t\t\tvalue = maybePromise as ResultValue\n\t\t\t}\n\n\t\t\tresults.push(value)\n\n\t\t\tif (onEach) onEach(value)\n\t\t\treturn delay(delayMs).then(next)\n\t\t}\n\t}\n\n\tawait Promise.resolve(next())\n\treturn results\n}\n"],"names":[],"mappings":"AAAA,eAAsB,OAGpB,OAiCC;AACF,QAAM,EAAE,SAAS,MAAM,OAAO,QAAQ,SAAa,IAAA;AAEnD,MAAI,UAAyB,CAAA;AAEvB,QAAA,QAAQ,CAAC,cAAsB,SACpC,IAAI,QAAQ,CAAC,SAAS,WAAW;AAC5B,QAAA;AAAU,eAAS,MAAM;AAC7B,eAAW,QAAQ,KAAK,MAAM,IAAI,GAAG,YAAY;AAAA,EAAA,CACjD;AAEF,MAAI,QAAQ;AAEZ,QAAM,OAAO,YAA8B;AACtC,QAAA,QAAQ,MAAM,QAAQ;AACnB,YAAA,OAAO,MAAM,KAAK;AAClB,YAAA,eAAe,KAAK,MAAM,KAAK;AAErC;AAEI,UAAA;AAEA,UAAA,aAAa,SAAS,QAAW;AACpC,gBAAS,MAAM;AAAA,MAAA,OACT;AACE,gBAAA;AAAA,MACT;AAEA,cAAQ,KAAK,KAAK;AAEd,UAAA;AAAQ,eAAO,KAAK;AACxB,aAAO,MAAM,OAAO,EAAE,KAAK,IAAI;AAAA,IAChC;AAAA,EAAA;AAGK,QAAA,QAAQ,QAAQ,KAAA,CAAM;AACrB,SAAA;AACR;"}